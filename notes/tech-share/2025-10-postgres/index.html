<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="400" y="30" font-size="20" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Long-Running Transaction: Resource Locking Effects
  </text>
  
  <!-- Java Application -->
  <rect x="50" y="60" width="120" height="80" fill="#3498db" stroke="#2c3e50" stroke-width="2" rx="5"/>
  <text x="110" y="95" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Java App</text>
  <text x="110" y="115" font-size="12" text-anchor="middle" fill="white">Transaction T1</text>
  <text x="110" y="130" font-size="10" text-anchor="middle" fill="#ecf0f1">(Started 10 min ago)</text>
  
  <!-- Arrow to PostgreSQL -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c"/>
    </marker>
  </defs>
  <line x1="170" y1="100" x2="280" y2="100" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="225" y="90" font-size="11" text-anchor="middle" fill="#e74c3c" font-weight="bold">HOLDING LOCKS</text>
  
  <!-- PostgreSQL Database -->
  <rect x="280" y="50" width="200" height="480" fill="#ecf0f1" stroke="#2c3e50" stroke-width="3" rx="5"/>
  <text x="380" y="75" font-size="16" font-weight="bold" text-anchor="middle" fill="#2c3e50">PostgreSQL</text>
  
  <!-- Locked Tables -->
  <rect x="300" y="95" width="160" height="120" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="3"/>
  <text x="380" y="115" font-size="13" font-weight="bold" text-anchor="middle" fill="white">üîí Locked Resources</text>
  
  <!-- Table 1 -->
  <rect x="310" y="125" width="140" height="35" fill="#c0392b" stroke="#922b21" stroke-width="1" rx="2"/>
  <text x="320" y="145" font-size="11" fill="white" font-weight="bold">Table: orders</text>
  <text x="320" y="157" font-size="9" fill="#ecf0f1">Row-level locks (100 rows)</text>
  
  <!-- Table 2 -->
  <rect x="310" y="168" width="140" height="35" fill="#c0392b" stroke="#922b21" stroke-width="1" rx="2"/>
  <text x="320" y="188" font-size="11" fill="white" font-weight="bold">Table: inventory</text>
  <text x="320" y="200" font-size="9" fill="#ecf0f1">Exclusive lock (UPDATE)</text>
  
  <!-- Waiting Transactions Queue -->
  <rect x="300" y="230" width="160" height="160" fill="#f39c12" stroke="#d68910" stroke-width="2" rx="3"/>
  <text x="380" y="250" font-size="13" font-weight="bold" text-anchor="middle" fill="#2c3e50">‚è≥ Waiting Transactions</text>
  
  <!-- T2 -->
  <rect x="310" y="260" width="140" height="30" fill="#e67e22" stroke="#ba6110" stroke-width="1" rx="2"/>
  <text x="320" y="280" font-size="10" fill="white">T2: SELECT...FOR UPDATE</text>
  
  <!-- T3 -->
  <rect x="310" y="295" width="140" height="30" fill="#e67e22" stroke="#ba6110" stroke-width="1" rx="2"/>
  <text x="320" y="315" font-size="10" fill="white">T3: UPDATE orders</text>
  
  <!-- T4 -->
  <rect x="310" y="330" width="140" height="30" fill="#e67e22" stroke="#ba6110" stroke-width="1" rx="2"/>
  <text x="320" y="350" font-size="10" fill="white">T4: DELETE inventory</text>
  
  <!-- T5 -->
  <rect x="310" y="365" width="140" height="20" fill="#d35400" stroke="#a04000" stroke-width="1" rx="2"/>
  <text x="320" y="379" font-size="9" fill="white">...more waiting...</text>
  
  <!-- Negative Effects -->
  <rect x="300" y="405" width="160" height="115" fill="#2c3e50" stroke="#1a252f" stroke-width="2" rx="3"/>
  <text x="380" y="423" font-size="12" font-weight="bold" text-anchor="middle" fill="white">‚ö†Ô∏è System Impact</text>
  
  <text x="310" y="440" font-size="9" fill="#ecf0f1">‚Ä¢ Connection pool exhausted</text>
  <text x="310" y="455" font-size="9" fill="#ecf0f1">‚Ä¢ Query timeouts increasing</text>
  <text x="310" y="470" font-size="9" fill="#ecf0f1">‚Ä¢ MVCC bloat accumulating</text>
  <text x="310" y="485" font-size="9" fill="#ecf0f1">‚Ä¢ Deadlock risk elevated</text>
  <text x="310" y="500" font-size="9" fill="#ecf0f1">‚Ä¢ WAL files growing</text>
  <text x="310" y="515" font-size="9" fill="#ecf0f1">‚Ä¢ Application performance ‚Üì</text>
  
  <!-- Other Applications -->
  <rect x="530" y="140" width="100" height="60" fill="#95a5a6" stroke="#7f8c8d" stroke-width="2" rx="5"/>
  <text x="580" y="165" font-size="12" text-anchor="middle" fill="white" font-weight="bold">Other Apps</text>
  <text x="580" y="185" font-size="10" text-anchor="middle" fill="#ecf0f1">T6, T7, T8...</text>
  
  <!-- Blocked arrow -->
  <line x1="480" y1="170" x2="520" y2="170" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,5"/>
  <circle cx="500" cy="170" r="15" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="500" y="176" font-size="18" font-weight="bold" text-anchor="middle" fill="white">‚úï</text>
  
  <text x="500" y="210" font-size="10" text-anchor="middle" fill="#e74c3c" font-weight="bold">BLOCKED</text>
  
  <!-- Time indicator -->
  <rect x="50" y="180" width="120" height="60" fill="#ffebee" stroke="#ef5350" stroke-width="2" rx="5"/>
  <text x="110" y="205" font-size="11" font-weight="bold" text-anchor="middle" fill="#c62828">‚è±Ô∏è Time Elapsed</text>
  <text x="110" y="223" font-size="16" font-weight="bold" text-anchor="middle" fill="#c62828">10 minutes</text>
  
  <!-- Legend -->
  <rect x="530" y="260" width="240" height="270" fill="white" stroke="#2c3e50" stroke-width="2" rx="5"/>
  <text x="650" y="285" font-size="14" font-weight="bold" text-anchor="middle" fill="#2c3e50">Key Issues</text>
  
  <circle cx="545" cy="305" r="5" fill="#e74c3c"/>
  <text x="560" y="310" font-size="10" fill="#2c3e50">Lock contention on rows/tables</text>
  
  <circle cx="545" cy="330" r="5" fill="#f39c12"/>
  <text x="560" y="335" font-size="10" fill="#2c3e50">Transaction queue buildup</text>
  
  <circle cx="545" cy="355" r="5" fill="#95a5a6"/>
  <text x="560" y="360" font-size="10" fill="#2c3e50">Cascading delays to other apps</text>
  
  <rect x="540" y="375" width="220" height="145" fill="#fff9e6" stroke="#f39c12" stroke-width="1" rx="3"/>
  <text x="650" y="393" font-size="11" font-weight="bold" text-anchor="middle" fill="#d68910">Common Causes:</text>
  <text x="545" y="410" font-size="9" fill="#2c3e50">‚Ä¢ Forgotten transaction (no commit/rollback)</text>
  <text x="545" y="425" font-size="9" fill="#2c3e50">‚Ä¢ Network timeout during processing</text>
  <text x="545" y="440" font-size="9" fill="#2c3e50">‚Ä¢ Heavy computation within transaction</text>
  <text x="545" y="455" font-size="9" fill="#2c3e50">‚Ä¢ External API call inside transaction</text>
  <text x="545" y="470" font-size="9" fill="#2c3e50">‚Ä¢ Large batch operations</text>
  <text x="545" y="485" font-size="9" fill="#2c3e50">‚Ä¢ Missing connection.close() in Java</text>
  <text x="545" y="500" font-size="9" fill="#2c3e50">‚Ä¢ Statement-level timeout not set</text>
  
  <!-- Bottom note -->
  <text x="400" y="570" font-size="11" text-anchor="middle" fill="#7f8c8d" font-style="italic">
    PostgreSQL MVCC allows reads to continue, but writes are blocked
  </text>
</svg>
